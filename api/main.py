
from fastapi import FastAPI
from objects import OptimizerInput, HeartbeatStatus
from scheduler.optimizer_v1_7 import compute_schedule

optimizer = FastAPI()

heartbeat = HeartbeatStatus
heartbeat.version = 1.7


@optimizer.get("/heartbeat/")
async def optimizer_heartbeat():
    return {
        "status": heartbeat.to_dict()
    }


@optimizer.post("/input/")
async def optimizer_input(payload: OptimizerInput):
    heartbeat.payload = payload.to_dict()
    compute_schedule(heartbeat)


@optimizer.get("/output/")
async def optimizer_output():
    return {
        "payload": {
            "run_id": "99999999-9999-9999-9999-999999999999",
            "num_search_workers": 4,
            "dynamic_variables": {
                "demand_forecast": {"columns":["day","hour","minute","demand"],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],"data":[[0,0,0,10],[0,0,15,10],[0,0,30,10],[0,0,45,10],[0,1,0,10],[0,1,15,10],[0,1,30,10],[0,1,45,10],[0,2,0,13],[0,2,15,13],[0,2,30,13],[0,2,45,13],[0,3,0,14],[0,3,15,14],[0,3,30,14],[0,3,45,14],[0,4,0,11],[0,4,15,11],[0,4,30,11],[0,4,45,11],[0,5,0,4],[0,5,15,4],[0,5,30,4],[0,5,45,4],[0,6,0,6],[0,6,15,6],[0,6,30,6],[0,6,45,6],[0,7,0,9],[0,7,15,9],[0,7,30,9],[0,7,45,9],[0,8,0,6],[0,8,15,6],[0,8,30,6],[0,8,45,6],[0,9,0,3],[0,9,15,3],[0,9,30,3],[0,9,45,3],[0,10,0,2],[0,10,15,2],[0,10,30,2],[0,10,45,2],[0,11,0,1],[0,11,15,1],[0,11,30,1],[0,11,45,1],[0,12,0,0],[0,12,15,0],[0,12,30,0],[0,12,45,0],[0,13,0,4],[0,13,15,4],[0,13,30,4],[0,13,45,4],[0,14,0,4],[0,14,15,4],[0,14,30,4],[0,14,45,4],[0,15,0,6],[0,15,15,6],[0,15,30,6],[0,15,45,6],[0,16,0,8],[0,16,15,8],[0,16,30,8],[0,16,45,8],[0,17,0,8],[0,17,15,8],[0,17,30,8],[0,17,45,8],[0,18,0,6],[0,18,15,6],[0,18,30,6],[0,18,45,6],[0,19,0,11],[0,19,15,11],[0,19,30,11],[0,19,45,11],[0,20,0,8],[0,20,15,8],[0,20,30,8],[0,20,45,8],[0,21,0,12],[0,21,15,12],[0,21,30,12],[0,21,45,12],[0,22,0,14],[0,22,15,14],[0,22,30,14],[0,22,45,14],[0,23,0,10],[0,23,15,10],[0,23,30,10],[0,23,45,10]]},
                "minimum_shifts": {"columns":["day","hour","minute","min_shifts"],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],"data":[[0,0,0,0],[0,0,15,0],[0,0,30,0],[0,0,45,0],[0,1,0,0],[0,1,15,0],[0,1,30,0],[0,1,45,0],[0,2,0,0],[0,2,15,0],[0,2,30,0],[0,2,45,0],[0,3,0,0],[0,3,15,0],[0,3,30,0],[0,3,45,0],[0,4,0,0],[0,4,15,0],[0,4,30,5],[0,4,45,5],[0,5,0,5],[0,5,15,6],[0,5,30,6],[0,5,45,8],[0,6,0,0],[0,6,15,0],[0,6,30,0],[0,6,45,0],[0,7,0,0],[0,7,15,0],[0,7,30,0],[0,7,45,0],[0,8,0,0],[0,8,15,0],[0,8,30,0],[0,8,45,0],[0,9,0,0],[0,9,15,0],[0,9,30,0],[0,9,45,0],[0,10,0,0],[0,10,15,0],[0,10,30,0],[0,10,45,0],[0,11,0,0],[0,11,15,0],[0,11,30,0],[0,11,45,0],[0,12,0,11],[0,12,15,11],[0,12,30,11],[0,12,45,11],[0,13,0,11],[0,13,15,11],[0,13,30,11],[0,13,45,11],[0,14,0,11],[0,14,15,11],[0,14,30,11],[0,14,45,11],[0,15,0,0],[0,15,15,0],[0,15,30,0],[0,15,45,0],[0,16,0,0],[0,16,15,0],[0,16,30,0],[0,16,45,0],[0,17,0,0],[0,17,15,0],[0,17,30,0],[0,17,45,0],[0,18,0,0],[0,18,15,0],[0,18,30,0],[0,18,45,0],[0,19,0,0],[0,19,15,0],[0,19,30,0],[0,19,45,0],[0,20,0,5],[0,20,15,8],[0,20,30,8],[0,20,45,8],[0,21,0,8],[0,21,15,7],[0,21,30,7],[0,21,45,7],[0,22,0,0],[0,22,15,0],[0,22,30,0],[0,22,45,0],[0,23,0,0],[0,23,15,0],[0,23,30,0],[0,23,45,0]]},
                "rush_hours":{"columns":["hour","minute","rush_hour"],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],"data":[[0,0,0],[0,15,0],[0,30,0],[0,45,0],[1,0,0],[1,15,0],[1,30,0],[1,45,0],[2,0,0],[2,15,0],[2,30,0],[2,45,0],[3,0,0],[3,15,0],[3,30,0],[3,45,0],[4,0,0],[4,15,0],[4,30,0],[4,45,0],[5,0,0],[5,15,0],[5,30,0],[5,45,0],[6,0,1],[6,15,1],[6,30,1],[6,45,1],[7,0,1],[7,15,1],[7,30,1],[7,45,1],[8,0,1],[8,15,1],[8,30,1],[8,45,1],[9,0,1],[9,15,1],[9,30,1],[9,45,1],[10,0,0],[10,15,0],[10,30,0],[10,45,0],[11,0,0],[11,15,0],[11,30,0],[11,45,0],[12,0,0],[12,15,0],[12,30,0],[12,45,0],[13,0,0],[13,15,0],[13,30,0],[13,45,0],[14,0,0],[14,15,0],[14,30,0],[14,45,0],[15,0,0],[15,15,0],[15,30,1],[15,45,1],[16,0,1],[16,15,1],[16,30,1],[16,45,1],[17,0,1],[17,15,1],[17,30,1],[17,45,1],[18,0,1],[18,15,1],[18,30,1],[18,45,0],[19,0,0],[19,15,0],[19,30,0],[19,45,0],[20,0,0],[20,15,0],[20,30,0],[20,45,0],[21,0,0],[21,15,0],[21,30,0],[21,45,0],[22,0,0],[22,15,0],[22,30,0],[22,45,0],[23,0,0],[23,15,0],[23,30,0],[23,45,0]]}, 
                "market_hours": {"columns":["day","hour","minute","open"],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],"data":[[0,0,0,0],[0,0,15,0],[0,0,30,0],[0,0,45,0],[0,1,0,0],[0,1,15,0],[0,1,30,0],[0,1,45,0],[0,2,0,0],[0,2,15,0],[0,2,30,0],[0,2,45,0],[0,3,0,0],[0,3,15,0],[0,3,30,0],[0,3,45,0],[0,4,0,0],[0,4,15,0],[0,4,30,1],[0,4,45,1],[0,5,0,1],[0,5,15,1],[0,5,30,1],[0,5,45,1],[0,6,0,1],[0,6,15,1],[0,6,30,1],[0,6,45,1],[0,7,0,1],[0,7,15,1],[0,7,30,1],[0,7,45,1],[0,8,0,1],[0,8,15,1],[0,8,30,1],[0,8,45,1],[0,9,0,1],[0,9,15,1],[0,9,30,1],[0,9,45,1],[0,10,0,1],[0,10,15,1],[0,10,30,1],[0,10,45,1],[0,11,0,1],[0,11,15,1],[0,11,30,1],[0,11,45,1],[0,12,0,1],[0,12,15,1],[0,12,30,1],[0,12,45,1],[0,13,0,1],[0,13,15,1],[0,13,30,1],[0,13,45,1],[0,14,0,1],[0,14,15,1],[0,14,30,1],[0,14,45,1],[0,15,0,1],[0,15,15,1],[0,15,30,1],[0,15,45,1],[0,16,0,1],[0,16,15,1],[0,16,30,1],[0,16,45,1],[0,17,0,1],[0,17,15,1],[0,17,30,1],[0,17,45,1],[0,18,0,1],[0,18,15,1],[0,18,30,1],[0,18,45,1],[0,19,0,1],[0,19,15,1],[0,19,30,1],[0,19,45,1],[0,20,0,1],[0,20,15,1],[0,20,30,1],[0,20,45,1],[0,21,0,1],[0,21,15,1],[0,21,30,1],[0,21,45,1],[0,22,0,1],[0,22,15,1],[0,22,30,1],[0,22,45,1],[0,23,0,1],[0,23,15,1],[0,23,30,1],[0,23,45,1]]}
            },
            "static_variables": {
                "num_vehicles": 20, 
                "min_duration": 4, 
                "max_duration": 10, 
                "cost_vehicle_per_minute": 2, 
                "revenue_passenger": 50, 
                "max_starts_per_slot": 5, 
                "max_ends_per_slot": 5, 
                "enable_rush_hour_constraint": False, 
                "enable_market_hour_constraint": True, 
                "enable_min_shift_constraint": False
            }
        }
            "solution": {"columns":["index","time","vehicles","starts","ends","day","hour","minute","demand"],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76],"data":[[0,"0-4-30",1,1,0,0,4,30,1.125],[1,"0-4-45",1,0,0,0,4,45,1.125],[2,"0-5-0",1,0,0,0,5,0,1.125],[3,"0-5-15",1,0,0,0,5,15,1.125],[4,"0-5-30",1,0,0,0,5,30,1.125],[5,"0-5-45",1,0,0,0,5,45,1.125],[6,"0-6-0",2,1,0,0,6,0,2.375],[7,"0-6-15",5,3,0,0,6,15,2.375],[8,"0-6-30",6,1,0,0,6,30,2.375],[9,"0-6-45",7,1,0,0,6,45,2.375],[10,"0-7-0",12,5,0,0,7,0,12.375],[11,"0-7-15",12,0,0,0,7,15,12.375],[12,"0-7-30",12,0,0,0,7,30,12.375],[13,"0-7-45",12,0,0,0,7,45,12.375],[14,"0-8-0",12,0,0,0,8,0,12.625],[15,"0-8-15",12,0,0,0,8,15,12.625],[16,"0-8-30",12,0,0,0,8,30,12.625],[17,"0-8-45",12,0,0,0,8,45,12.625],[18,"0-9-0",12,0,0,0,9,0,11.375],[19,"0-9-15",12,0,0,0,9,15,11.375],[20,"0-9-30",12,0,0,0,9,30,11.375],[21,"0-9-45",12,0,0,0,9,45,11.375],[22,"0-10-0",12,0,0,0,10,0,10.125],[23,"0-10-15",13,1,1,0,10,15,10.125],[24,"0-10-30",12,0,2,0,10,30,10.125],[25,"0-10-45",10,0,0,0,10,45,10.125],[26,"0-11-0",10,0,1,0,11,0,10.0],[27,"0-11-15",10,1,0,0,11,15,10.0],[28,"0-11-30",10,0,0,0,11,30,10.0],[29,"0-11-45",12,2,0,0,11,45,10.0],[30,"0-12-0",12,0,2,0,12,0,9.25],[31,"0-12-15",10,0,0,0,12,15,9.25],[32,"0-12-30",10,0,0,0,12,30,9.25],[33,"0-12-45",10,0,0,0,12,45,9.25],[34,"0-13-0",11,1,0,0,13,0,9.5],[35,"0-13-15",11,0,1,0,13,15,9.5],[36,"0-13-30",10,0,1,0,13,30,9.5],[37,"0-13-45",10,1,1,0,13,45,9.5],[38,"0-14-0",9,0,0,0,14,0,7.375],[39,"0-14-15",9,0,1,0,14,15,7.375],[40,"0-14-30",9,1,0,0,14,30,7.375],[41,"0-14-45",9,0,0,0,14,45,7.375],[42,"0-15-0",11,2,0,0,15,0,10.875],[43,"0-15-15",11,0,2,0,15,15,10.875],[44,"0-15-30",9,0,0,0,15,30,10.875],[45,"0-15-45",9,0,0,0,15,45,10.875],[46,"0-16-0",10,1,0,0,16,0,10.875],[47,"0-16-15",10,0,0,0,16,15,10.875],[48,"0-16-30",10,0,0,0,16,30,10.875],[49,"0-16-45",10,0,0,0,16,45,10.875],[50,"0-17-0",10,0,0,0,17,0,10.625],[51,"0-17-15",10,0,0,0,17,15,10.625],[52,"0-17-30",10,0,0,0,17,30,10.625],[53,"0-17-45",10,0,1,0,17,45,10.625],[54,"0-18-0",9,0,0,0,18,0,7.5],[55,"0-18-15",9,0,0,0,18,15,7.5],[56,"0-18-30",9,0,1,0,18,30,7.5],[57,"0-18-45",8,0,2,0,18,45,7.5],[58,"0-19-0",6,0,1,0,19,0,5.25],[59,"0-19-15",5,0,0,0,19,15,5.25],[60,"0-19-30",5,0,0,0,19,30,5.25],[61,"0-19-45",5,0,0,0,19,45,5.25],[62,"0-20-0",5,0,1,0,20,0,3.625],[63,"0-20-15",4,0,0,0,20,15,3.625],[64,"0-20-30",4,0,0,0,20,30,3.625],[65,"0-20-45",4,0,0,0,20,45,3.625],[66,"0-21-0",4,0,0,0,21,0,3.875],[67,"0-21-15",4,0,0,0,21,15,3.875],[68,"0-21-30",4,0,0,0,21,30,3.875],[69,"0-21-45",4,0,2,0,21,45,3.875],[70,"0-22-0",2,0,0,0,22,0,1.5],[71,"0-22-15",2,0,0,0,22,15,1.5],[72,"0-22-30",2,0,0,0,22,30,1.5],[73,"0-22-45",2,0,0,0,22,45,1.5],[74,"0-23-0",2,0,0,0,23,0,2.25],[75,"0-23-15",2,0,0,0,23,15,2.25],[76,"0-23-30",2,0,2,0,23,30,2.25]]},
            "schedule": {"columns":["index","vehicle","day","hour","minute","duration","start_time","end_time"],"index":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],"data":[[0,0,0,4,30,375,"1900-01-01 04:30:00+00:00","1900-01-01 10:45:00+00:00"],[1,1,0,6,0,270,"1900-01-01 06:00:00+00:00","1900-01-01 10:30:00+00:00"],[2,2,0,6,15,270,"1900-01-01 06:15:00+00:00","1900-01-01 10:45:00+00:00"],[3,3,0,6,15,360,"1900-01-01 06:15:00+00:00","1900-01-01 12:15:00+00:00"],[4,4,0,6,15,495,"1900-01-01 06:15:00+00:00","1900-01-01 14:30:00+00:00"],[5,5,0,6,30,435,"1900-01-01 06:30:00+00:00","1900-01-01 13:45:00+00:00"],[6,6,0,7,0,390,"1900-01-01 07:00:00+00:00","1900-01-01 13:30:00+00:00"],[7,7,0,7,0,255,"1900-01-01 07:00:00+00:00","1900-01-01 11:15:00+00:00"],[8,8,0,7,0,420,"1900-01-01 07:00:00+00:00","1900-01-01 14:00:00+00:00"],[9,9,0,7,0,315,"1900-01-01 07:00:00+00:00","1900-01-01 12:15:00+00:00"],[10,10,0,7,0,510,"1900-01-01 07:00:00+00:00","1900-01-01 15:30:00+00:00"],[11,11,0,7,0,510,"1900-01-01 07:00:00+00:00","1900-01-01 15:30:00+00:00"],[12,12,0,10,15,510,"1900-01-01 10:15:00+00:00","1900-01-01 18:45:00+00:00"],[13,13,0,11,15,465,"1900-01-01 11:15:00+00:00","1900-01-01 19:00:00+00:00"],[14,14,0,11,45,450,"1900-01-01 11:45:00+00:00","1900-01-01 19:15:00+00:00"],[15,15,0,13,0,360,"1900-01-01 13:00:00+00:00","1900-01-01 19:00:00+00:00"],[16,16,0,13,0,420,"1900-01-01 13:00:00+00:00","1900-01-01 20:00:00+00:00"],[17,17,0,13,45,255,"1900-01-01 13:45:00+00:00","1900-01-01 18:00:00+00:00"],[18,18,0,14,30,450,"1900-01-01 14:30:00+00:00","1900-01-01 22:00:00+00:00"],[19,19,0,15,0,420,"1900-01-01 15:00:00+00:00","1900-01-01 22:00:00+00:00"],[20,20,0,15,0,525,"1900-01-01 15:00:00+00:00","1900-01-01 23:45:00+00:00"],[21,21,0,16,0,465,"1900-01-01 16:00:00+00:00","1900-01-01 23:45:00+00:00"]]}
        }
    }
